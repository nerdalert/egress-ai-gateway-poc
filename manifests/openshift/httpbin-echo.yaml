# httpbin.org backend for header echo testing.
# Used to verify that Authorino-injected headers (e.g., X-Provider-Api-Key)
# arrive at the upstream. httpbin's /headers endpoint echoes all received
# headers back in the response body.
#
# Test via bridge:
#   curl -sSk -H "Authorization: Bearer $SA_TOKEN" \
#     "https://${MAAS_HOST}/external/headers" | jq .headers
#
# Look for: "X-Provider-Api-Key": "sk-poc-hardcoded-api-key-for-testing"
apiVersion: ainetworking.prototype.x-k8s.io/v0alpha0
kind: XBackendDestination
metadata:
  name: httpbin-backend
  namespace: default
spec:
  destination:
    type: Fqdn
    fqdn:
      hostname: httpbin.org
    ports:
    - number: 80
      protocol: HTTP
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: httpbin-route
  namespace: default
spec:
  parentRefs:
  - name: poc-gateway
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: "/get"
    - path:
        type: PathPrefix
        value: "/headers"
    backendRefs:
    - name: httpbin-backend
      kind: Backend
      group: ainetworking.prototype.x-k8s.io
      port: 80
